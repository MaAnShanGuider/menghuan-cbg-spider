## 记录问题


#### 登录接口


```js

		if (s._$getSmState() && b[d]) a.data = {
					encParams: s._$sm4Encrypt(a.data)
				};


	h._$sm4Encrypt = function (e) {
			return window.URSSM4.encrypt(JSON.stringify(e), x)
		};

```

```js
channel: 0
pd: "cbg"
pkht: "cbg.163.com"
pkid: "aqpOBwV"
rtid: "fsr6dLf7KD158EnORjaqTW0XHsuvOVNF"
topURL: "https://xyq-m.cbg.163.com/cgi/mweb/show_login?back_url=%2Fcgi%2Fmweb%2Flogin%2Farea%3Fback_url%3Dhttps%253A%252F%252Fxyq-m.cbg.163.com%252Fcgi%252Fmweb%252Fuser%253F_mobile_tips%253D1"
```
找到pkid 和 rtid，那么那个en什么的，就算ok了

```
__loadConfig

window._$PKID
window._$RTID

```
至于`_$TOPURL`，写死就行了

```js
//  _$RTID的生成方法
 function () {
	var e = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",
		t = 32,
		i = [];
	for (; t-- > 0;) i[t] = e.charAt(Math.random() * e.length);
	return i.join("")
	}
```
那剩下的，就只有`._$PKID`


下面这个涉及到密码

也是奇了怪了，登录的时候，密码的字段不知道怎么到哪里去了，
希望下面这个能够给点线索！


```js
	v.__doRegReal = function () {
			this.__onDoLockReg();
			if (this.__collect) this._events = this.__collect._$getEvents();
			var e = this.__registerModule._$getValues();
			this.__username = e[0].trim();
			this.__password = e[1];
			this.__smscode = e[2];
			if (this.__pass) {
				var t = {
					un: this.__username,
					pw: MP.encrypt(this.__password, this.__username),
					events: JSON.stringify(this._events),
					channel: 2,
					pd: this.__product,
					pkid: this.__promark
				};
				s._$request("getTicket", t, this.__getTicket._$bind(this), this.__getTicketException._$bind(this));
			}
		};
```

```js
	var s = this.$refs.mninput._$getValue().trim();
	if (n._$getSmState()) e.un = s;
	else e.mb = s;
	e.sms = this.$refs.smsinput._$getValue().trim();
	if (this.$refs.mpinput) e.pw = MP.encrypt(this.$refs.mpinput._$getValue(), s);
```

```js
{
3646: function (e, t, i) {
				var n = i(7228);
				e.exports = function (e) {
					if (Array.isArray(e)) return n(e)
				},
					e.exports["default"] = e.exports,
					e.exports.__esModule = !0
			},
7228: function (e) {
	e.exports = function (e, t) {
		(null == t || t > e.length) && (t = e.length);
		for (var i = 0,
			n = new Array(t); i < t; i++) n[i] = e[i];
		return n
	},
		e.exports["default"] = e.exports,
		e.exports.__esModule = !0
},
}
```


## encParams 生成

1. 首先是这个生成了参数 encParams

```
		if (s._$getSmState() && b[d]) a.data = {
					encParams: s._$sm4Encrypt(a.data)
				};
```

2. 然后我们找到`s._$sm4Encrypt`

```
h._$sm4Encrypt = function (e) {
		return window.URSSM4.encrypt(JSON.stringify(e), x)
	};
```

3. 再找到 `window.URSSM4`

## 网易的流程

### 零、[get]:

```
https://xyq-m.cbg.163.com/cgi/api/get_login_info?page_session_id=-&_=1659928880857
```
response 设置cookie:

```
set-cookie: _flow_group=g10; Domain=.cbg.163.com; Max-Age=315388799; Path=/; expires=Thu, 05-Aug-2032 11:21:18 GMT
set-cookie: is_log_active_stat=1; Max-Age=1200; Path=/; expires=Mon, 08-Aug-2022 03:41:19 GMT
set-cookie: _external_mark=direct; Path=/
```
### 零-一、[post]

```
url：https://dl.reg.163.com/dl/zj/mail/ini

data: {"encParams":"e7a3d4c8fe98587c99be7f282b26cf006d65c51b439ccae8f652efecdba169ab0a6d30ac13ad5029c570494d34a1771ab6d3154c6e57ac48c09370303ea6760afcd4b3793b5525952aad1f4b3c2266fc14264324eb456e0e4f1a92f8ed88b2b4f2af001d3aa138bf6635df14f21b249e63978af0fa8ccc979159725d8343a2066ebd0feb296a28ee4c881ac78f02ab48ee0b674a22fedf636382f832abfa73ea073e0a17dd0a5b69c1b2811b195fd37cbef71733432786f47e74546b89760b70ae23b707e8859ebd397e6c459169268335aa323b979b641ad8db97cb0594acacd81a327b1672319ca5c255cf86c66835"}
```
request cookie:
```
Cookie: utid=3HTwqdWN39Aoa7bkHS2iHVBwwa6l2O9O; NTES_WEB_FP=0f81934c4e49154fae71a755def6e08f; l_s_mail163CvViHzl=2BDA1093FDDA9283AD02B57FFFEC7E0E378424D582286FD45124E04C194D0516E463CBA328C9D87ECD9D07B6A36C5AC2F41A4635296224839DCD56622611EC0A18DE18583B4011E698D96533B03E798B71BFC92B76870E970546DAA5442357F8A4A12D0B23C7915969EA971C139E36DA; l_s_cbgaqpOBwV=50D7EFE8E1E36B32F3B9CF3038C36652DF2818C6BBD8B28D67BBEEE57B1DFBC0C0E8005F5EB38DDFBD31104E00F738151DBE0AE95B611326941CA90221924F98495C0A6326FBF2FD05527266938B66E789F734C31F9815DB76012D5FF49BC3277CE7EE75E805701D18A9BF116F039D6D; THE_LAST_LOGIN=1436089483@qq.com
```

response 设置cookie:
```
Set-Cookie: l_s_cbgaqpOBwV=50D7EFE8E1E36B32F3B9CF3038C36652DF2818C6BBD8B28D67BBEEE57B1DFBC0AD79EC0E0D1652AA2E27142CA533830BB98F5B68536B28330352ED92A8609E83495C0A6326FBF2FD05527266938B66E789F734C31F9815DB76012D5FF49BC3277CE7EE75E805701D18A9BF116F039D6D; path=/; expires=Wed, 7-Sep-2022 03:21:20 GMT
```

### 零-二、
### 一、 开始会请求 [get]:
```
https://xyq-m.cbg.163.com/cgi/api/get_login_info?page_session_id=0181A568-B05F-1805-FFCC-1AAAA1345137&_=1656337561716

```
- `page_session_id`: 就用那个生成的
- `_`: 就是时间戳

一般地，这个会返回:
```
	{"msg": "urs not login", "status": 2, "status_code": "SESSION_TIMEOUT"}

```
即，用户未登录。

### 二、初始化数据[post]

#### URL
```
https://dl.reg.163.com/dl/zj/mail/ini

```
#### 参数
```
{"encParams":"e7a3d4c8fe98587c99be7f282b26cf006d65c51b439ccae8f652efecdba169ab0a6d30ac13ad5029c570494d34a1771ab6d3154c6e57ac48c09370303ea6760afcd4b3793b5525952aad1f4b3c2266fc14264324eb456e0e4f1a92f8ed88b2b4f2af001d3aa138bf6635df14f21b249e63978af0fa8ccc979159725d8343a2066ebd0feb296a28ee4c881ac78f02ab48ee0b674a22fedf636382f832abfa73ea073e0a17dd0a5b69c1b2811b195fd37cbef71733432786f47e74546b89760b7027a47a476d9442c49e1dc8d3521b482f2c4b141852750e288020d5f9a75b108ede632619e4e16cc634f98057091579d3"}

```

#### response
```
{"ret":"201","capFlag":0,"watchman":0,"capId":""}
```

